using PenTestDataViewer.Api.Model;
using System.Net;

namespace PenTestDataViewer.Api.DataTransferModel.Host
{
    public class HostDto
    {
        public static HostDto FromDatabaseModel(Model.Host host) => new HostDto
        {
            Id = host.Id,
            IPv4 = host.IPv4,
            IPv6 = host.IPv6,
            OS = host.OS,
            Domains = host.Domains.Select(d => HostDomainDto.FromDatabaseModel(d)).ToList(),
            Ports = host.Ports.Select(HostPortDto.FromDatabaseModel).ToList(),
        };

        public static Model.Host ToDatabaseModel(HostDto host)
        {
            var model = new Model.Host { IPv4=host.IPv4, IPv6=host.IPv6 };
            model.Id = host.Id ?? Guid.NewGuid();

            model.OS = host.OS;
            if (host.Domains?.Any() ?? false)
            {
                model.Domains
                    .AddRange(host.Domains.Select(HostDomainDto.ToDatabaseModel));
            }

            if (host.Ports?.Any() ?? false)
            {
                model.Ports
                    .AddRange(host.Ports.Select(p => HostPortDto.ToDatabaseModel(p, model.Id)));
            }

            return model;
        }

        public Guid? Id { get; set; }

        public string? IPv4 { get; set; }

        public string? IPv6 { get; set; }

        public string? OS { get; set; }

        public List<HostDomainDto>? Domains { get; set; }

        public List<HostPortDto> Ports { get; set; }
    }
}
